syntax = "proto3";
import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/wrappers.proto";
import "common.proto";

option csharp_namespace = "People.Grpc.Identity";

service Identity {
  rpc GetAccountById (people.AccountId) returns (AccountReply);
  rpc GetStatus (people.AccountId) returns (StatusReply);

  rpc SignInByEmail (SignInByEmailRequest) returns (SignInReply);
  rpc SignInByGoogle (SignInBySocialRequest) returns (SignInReply);
  rpc SignInByMicrosoft (SignInBySocialRequest) returns (SignInReply);

  rpc SignUpByEmail (SignUpByEmailRequest) returns (SignUpReply);
  rpc SignUpByGoogle (SignUpBySocialRequest) returns (SignUpReply);
  rpc SignUpByMicrosoft (SignUpBySocialRequest) returns (SignUpReply);
  rpc IsConfirmationAvailable (people.Confirming) returns (people.AccountId);
  rpc ConfirmSignUp (ConfirmSignUpRequest) returns (google.protobuf.Empty);
  rpc ResendSignUpConfirmation (ResendSignUpConfirmationRequest) returns (people.Confirming);

  rpc AttachEmail(AttachRequest) returns (google.protobuf.Empty);
  rpc AttachGoogle(AttachRequest) returns (google.protobuf.Empty);
  rpc AttachMicrosoft(AttachRequest) returns (google.protobuf.Empty);

  rpc ResetPassword (ResetPasswordRequest) returns (people.AccountId);
  rpc RestorePassword (RestorePasswordRequest) returns (google.protobuf.Empty);
}

message SignInByEmailRequest {
  string email = 1;
  string password = 2;
  string ip = 3;
  string language = 4;
}

message SignInBySocialRequest {
  string access_token = 1;
  string ip = 2;
  string language = 3;
}

message SignUpByEmailRequest {
  string email = 1;
  string password = 2;
  string ip = 3;
  string language = 4;
}

message SignUpBySocialRequest {
  string access_token = 1;
  string ip = 2;
  string language = 3;
}

message ResetPasswordRequest {
  people.Identity identity = 1;
  string language = 2;
}

message RestorePasswordRequest {
  people.AccountId id = 1;
  people.Confirm confirm = 2;
  string password = 3;
}

message SignInReply {
  people.AccountId id = 1;
  string display_name = 2;
}

message SignUpReply {
  people.AccountId id = 1;
  string display_name = 2;
  people.Confirming confirmation = 3;
}

message ConfirmSignUpRequest {
  people.AccountId id = 1;
  people.Confirm confirm = 2;
}

message ResendSignUpConfirmationRequest {
  people.AccountId id = 1;
  string language = 2;
}

message AccountReply {
  people.AccountId id = 1;
  people.Name name = 2;
  people.PrimaryEmail email = 3;
  people.Address address = 4;
  string time_zone = 5;
  people.DayOfWeek first_day_of_week = 6;
  string language = 7;
  people.Gender gender = 8;
  google.protobuf.Timestamp date_of_birth = 9;
  google.protobuf.StringValue bio = 10;
  string picture = 11;
  people.Ban ban = 12;
  google.protobuf.Timestamp updated_at = 13;
  repeated string roles = 14;
}

message StatusReply {
  bool is_active = 1;
}

message AttachRequest {
  people.AccountId id = 1;
  string value = 2;
}
